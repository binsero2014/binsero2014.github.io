<html class="h-full bg-gray-100" lang="id">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   Family Freshwater Refill Depot
  </title>
  <script src="https://cdn.tailwindcss.com">
  </script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter&amp;display=swap" rel="stylesheet"/>
  <style>
   body {
      font-family: 'Inter', sans-serif;
    }
    /* Scrollbar for left menu */
    #leftMenu::-webkit-scrollbar {
      width: 6px;
    }
    #leftMenu::-webkit-scrollbar-thumb {
      background-color: rgba(100, 116, 139, 0.5);
      border-radius: 3px;
    }
  </style>
 </head>
 <body class="h-full flex flex-col">
  <div class="flex flex-1 min-h-0 overflow-hidden">
   <!-- Left Menu -->
   <nav aria-label="Sidebar" class="w-72 bg-white border-r border-gray-300 flex flex-col overflow-y-auto" id="leftMenu">
    <div class="px-6 py-5 border-b border-gray-300 flex items-center space-x-3">
     <img alt="Logo Family Freshwater Refill Depot, blue water drop with family icon" class="w-10 h-10 rounded-full" height="40" src="https://storage.googleapis.com/a1aa/image/69b9f154-5df7-44e8-93a2-21678689e937.jpg" width="40"/>
     <h1 class="text-xl font-semibold text-blue-700">
      Family Freshwater
     </h1>
    </div>
    <div class="px-6 py-4 border-b border-gray-300">
     <form class="space-y-3" id="loginForm">
      <h2 class="text-lg font-semibold text-gray-700">
       Login
      </h2>
      <div>
       <label class="block text-sm font-medium text-gray-700" for="username">
        Username
       </label>
       <input autocomplete="username" class="mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-300 focus:ring-opacity-50" id="username" name="username" placeholder="Admin" required="" type="text"/>
      </div>
      <div>
       <label class="block text-sm font-medium text-gray-700" for="password">
        Password
       </label>
       <input autocomplete="current-password" class="mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-300 focus:ring-opacity-50" id="password" name="password" placeholder="putra" required="" type="password"/>
      </div>
      <button class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1" type="submit">
       Login
      </button>
      <p class="text-red-600 text-sm hidden" id="loginError">
       Username atau password salah.
      </p>
     </form>
    </div>
    <div class="flex-1 px-2 py-4 overflow-y-auto" id="menuTree" style="display:none;">
     <ul class="space-y-2 text-gray-700 text-sm select-none">
      <li>
       <button aria-controls="menuMaster" aria-expanded="false" class="w-full flex items-center justify-between px-3 py-2 rounded-md hover:bg-blue-100 focus:outline-none focus:bg-blue-100" id="btnMenuMaster" type="button">
        <span class="flex items-center space-x-2 font-semibold text-blue-700">
         <i class="fas fa-cogs">
         </i>
         <span>
          Menu Master
         </span>
        </span>
        <i class="fas fa-chevron-right transition-transform duration-200" id="iconMenuMaster">
        </i>
       </button>
       <ul aria-labelledby="btnMenuMaster" class="mt-1 ml-5 space-y-1 max-h-0 overflow-hidden transition-all duration-300" id="menuMaster">
        <li>
         <button class="w-full text-left px-3 py-1 rounded-md hover:bg-blue-50 focus:outline-none focus:bg-blue-50" data-menu="masterUser" type="button">
          Master User
         </button>
        </li>
        <li>
         <button class="w-full text-left px-3 py-1 rounded-md hover:bg-blue-50 focus:outline-none focus:bg-blue-50" data-menu="masterHarga" type="button">
          Master Harga Barang &amp; Jumlah
         </button>
        </li>
        <li>
         <button class="w-full text-left px-3 py-1 rounded-md hover:bg-blue-50 focus:outline-none focus:bg-blue-50" data-menu="masterSupplier" type="button">
          Master Supplier
         </button>
        </li>
        <li>
         <button class="w-full text-left px-3 py-1 rounded-md hover:bg-blue-50 focus:outline-none focus:bg-blue-50" data-menu="masterCustomer" type="button">
          Master Customer
         </button>
        </li>
       </ul>
      </li>
      <li>
       <button aria-controls="menuTransaksi" aria-expanded="false" class="w-full flex items-center justify-between px-3 py-2 rounded-md hover:bg-blue-100 focus:outline-none focus:bg-blue-100" id="btnMenuTransaksi" type="button">
        <span class="flex items-center space-x-2 font-semibold text-blue-700">
         <i class="fas fa-exchange-alt">
         </i>
         <span>
          Transaksi
         </span>
        </span>
        <i class="fas fa-chevron-right transition-transform duration-200" id="iconMenuTransaksi">
        </i>
       </button>
       <ul aria-labelledby="btnMenuTransaksi" class="mt-1 ml-5 space-y-1 max-h-0 overflow-hidden transition-all duration-300" id="menuTransaksi">
        <li>
         <button class="w-full text-left px-3 py-1 rounded-md hover:bg-blue-50 focus:outline-none focus:bg-blue-50" data-menu="dataEntriPenjualan" type="button">
          Data Entri Transaksi Penjualan
         </button>
        </li>
        <li>
         <button class="w-full text-left px-3 py-1 rounded-md hover:bg-blue-50 focus:outline-none focus:bg-blue-50" data-menu="dataEntriPembelian" type="button">
          Data Entri Pembelian Barang dari Supplier
         </button>
        </li>
       </ul>
      </li>
      <li>
       <button aria-controls="menuLaporan" aria-expanded="false" class="w-full flex items-center justify-between px-3 py-2 rounded-md hover:bg-blue-100 focus:outline-none focus:bg-blue-100" id="btnMenuLaporan" type="button">
        <span class="flex items-center space-x-2 font-semibold text-blue-700">
         <i class="fas fa-file-alt">
         </i>
         <span>
          Laporan
         </span>
        </span>
        <i class="fas fa-chevron-right transition-transform duration-200" id="iconMenuLaporan">
        </i>
       </button>
       <ul aria-labelledby="btnMenuLaporan" class="mt-1 ml-5 space-y-1 max-h-0 overflow-hidden transition-all duration-300" id="menuLaporan">
        <li>
         <button class="w-full text-left px-3 py-1 rounded-md hover:bg-blue-50 focus:outline-none focus:bg-blue-50" data-menu="laporanPenjualanPerPeriode" type="button">
          Laporan Transaksi Penjualan Per Periode
         </button>
        </li>
        <li>
         <button class="w-full text-left px-3 py-1 rounded-md hover:bg-blue-50 focus:outline-none focus:bg-blue-50" data-menu="laporanPembelianBulanan" type="button">
          Laporan Transaksi Bulanan Pembelian dari Supplier
         </button>
        </li>
        <li>
         <button class="w-full text-left px-3 py-1 rounded-md hover:bg-blue-50 focus:outline-none focus:bg-blue-50" data-menu="laporanPenjualanBulanan" type="button">
          Laporan Bulanan Transaksi Penjualan
         </button>
        </li>
        <li>
         <button class="w-full text-left px-3 py-1 rounded-md hover:bg-blue-50 focus:outline-none focus:bg-blue-50" data-menu="laporanLabaRugiPerPeriode" type="button">
          Laporan Laba Rugi Per Periode
         </button>
        </li>
        <li>
         <button class="w-full text-left px-3 py-1 rounded-md hover:bg-blue-50 focus:outline-none focus:bg-blue-50" data-menu="laporanStokPerPeriode" type="button">
          Laporan Stok Per Periode
         </button>
        </li>
       </ul>
      </li>
     </ul>
    </div>
   </nav>
   <!-- Main Content Area -->
   <main class="flex-1 flex flex-col overflow-hidden">
    <header class="bg-white border-b border-gray-300 px-6 py-4 flex items-center justify-between">
     <h2 class="text-xl font-semibold text-gray-800" id="pageTitle">
      Selamat Datang di Family Freshwater Refill Depot
     </h2>
    </header>
    <section aria-live="polite" class="flex-1 overflow-auto bg-white p-6" id="popupContent" tabindex="0">
     <div class="text-gray-500 text-center mt-20 select-none">
      <i class="fas fa-info-circle fa-3x mb-4">
      </i>
      <p>
       Pilih menu di sebelah kiri untuk mulai mengelola data.
      </p>
     </div>
    </section>
   </main>
  </div>
  <script>
   (() => {
      // Elements
      const loginForm = document.getElementById('loginForm');
      const usernameInput = loginForm.username;
      const passwordInput = loginForm.password;
      const loginError = document.getElementById('loginError');
      const menuTree = document.getElementById('menuTree');
      const pageTitle = document.getElementById('pageTitle');
      const popupContent = document.getElementById('popupContent');

      // Treeview toggles
      const toggles = [
        { btnId: 'btnMenuMaster', menuId: 'menuMaster', iconId: 'iconMenuMaster' },
        { btnId: 'btnMenuTransaksi', menuId: 'menuTransaksi', iconId: 'iconMenuTransaksi' },
        { btnId: 'btnMenuLaporan', menuId: 'menuLaporan', iconId: 'iconMenuLaporan' },
      ];

      toggles.forEach(({ btnId, menuId, iconId }) => {
        const btn = document.getElementById(btnId);
        const menu = document.getElementById(menuId);
        const icon = document.getElementById(iconId);
        btn.addEventListener('click', () => {
          const expanded = btn.getAttribute('aria-expanded') === 'true';
          btn.setAttribute('aria-expanded', !expanded);
          if (!expanded) {
            menu.style.maxHeight = menu.scrollHeight + 'px';
            icon.classList.add('rotate-90');
          } else {
            menu.style.maxHeight = '0';
            icon.classList.remove('rotate-90');
          }
        });
      });

      // Data storage (simulate DB)
      let data = {
        users: [
          { id: 1, username: 'Admin', fullName: 'Administrator', role: 'Admin' },
          { id: 2, username: 'user1', fullName: 'User Satu', role: 'User' },
        ],
        hargaBarang: [
          { id: 1, namaBarang: 'Galon Air Mineral 19L', harga: 15000, jumlah: 100 },
          { id: 2, namaBarang: 'Botol Air 600ml', harga: 5000, jumlah: 200 },
          { id: 3, namaBarang: 'Galon Air Isi Ulang 19L', harga: 12000, jumlah: 150 },
        ],
        suppliers: [
          { id: 1, nama: 'PT. Aqua Supplier', alamat: 'Jl. Merdeka No. 10', telepon: '081234567890' },
          { id: 2, nama: 'CV. Air Bersih', alamat: 'Jl. Sudirman No. 5', telepon: '082345678901' },
        ],
        customers: [
          { id: 1, nama: 'Budi Santoso', alamat: 'Jl. Melati No. 3', telepon: '081298765432' },
          { id: 2, nama: 'Sari Dewi', alamat: 'Jl. Kenanga No. 7', telepon: '082198765432' },
        ],
        transaksiPenjualan: [
          {
            id: 1,
            tanggal: '2024-06-01',
            customer: 'Budi Santoso',
            barang: 'Galon Air Isi Ulang 19L',
            jumlah: 3,
            harga: 12000,
            keterangan: 'Pembelian rutin',
          },
          {
            id: 2,
            tanggal: '2024-06-02',
            customer: 'Sari Dewi',
            barang: 'Botol Air 600ml',
            jumlah: 10,
            harga: 5000,
            keterangan: 'Untuk acara keluarga',
          },
        ],
        transaksiPembelian: [
          {
            id: 1,
            tanggal: '2024-05-28',
            supplier: 'PT. Aqua Supplier',
            barang: 'Galon Air Mineral 19L',
            jumlah: 50,
            harga: 15000,
            keterangan: 'Stok tambahan',
          },
          {
            id: 2,
            tanggal: '2024-06-01',
            supplier: 'CV. Air Bersih',
            barang: 'Galon Air Isi Ulang 19L',
            jumlah: 70,
            harga: 12000,
            keterangan: 'Pengisian stok',
          },
        ],
      };

      // Helper: format currency
      function formatRupiah(num) {
        return 'Rp ' + num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
      }

      // Helper: create table with edit & delete buttons
      function createTable(headers, rows, onEdit, onDelete) {
        const table = document.createElement('table');
        table.className = 'min-w-full divide-y divide-gray-200 border border-gray-300 rounded-md';

        const thead = document.createElement('thead');
        thead.className = 'bg-blue-50';
        const trHead = document.createElement('tr');
        headers.forEach((h) => {
          const th = document.createElement('th');
          th.scope = 'col';
          th.className =
            'px-4 py-2 text-left text-xs font-medium text-blue-700 uppercase tracking-wider select-none';
          th.textContent = h;
          trHead.appendChild(th);
        });
        // Extra header for actions
        const thAction = document.createElement('th');
        thAction.scope = 'col';
        thAction.className =
          'px-4 py-2 text-center text-xs font-medium text-blue-700 uppercase tracking-wider select-none';
        thAction.textContent = 'Aksi';
        trHead.appendChild(thAction);

        thead.appendChild(trHead);
        table.appendChild(thead);

        const tbody = document.createElement('tbody');
        tbody.className = 'bg-white divide-y divide-gray-200';

        rows.forEach((row, i) => {
          const tr = document.createElement('tr');
          tr.className = i % 2 === 0 ? '' : 'bg-gray-50';
          row.forEach((cell) => {
            const td = document.createElement('td');
            td.className = 'px-4 py-2 text-sm text-gray-700 whitespace-nowrap';
            if (typeof cell === 'string' || typeof cell === 'number') {
              td.textContent = cell;
            } else if (cell instanceof HTMLElement) {
              td.appendChild(cell);
            }
            tr.appendChild(td);
          });

          // Actions
          const tdAction = document.createElement('td');
          tdAction.className = 'px-4 py-2 text-center space-x-2';

          const btnEdit = document.createElement('button');
          btnEdit.type = 'button';
          btnEdit.className =
            'text-blue-600 hover:text-blue-800 focus:outline-none focus:underline';
          btnEdit.innerHTML = '<i class="fas fa-edit"></i>';
          btnEdit.title = 'Edit';
          btnEdit.addEventListener('click', () => onEdit(row, i));

          const btnDelete = document.createElement('button');
          btnDelete.type = 'button';
          btnDelete.className =
            'text-red-600 hover:text-red-800 focus:outline-none focus:underline';
          btnDelete.innerHTML = '<i class="fas fa-trash-alt"></i>';
          btnDelete.title = 'Hapus';
          btnDelete.addEventListener('click', () => onDelete(row, i));

          tdAction.appendChild(btnEdit);
          tdAction.appendChild(btnDelete);
          tr.appendChild(tdAction);

          tbody.appendChild(tr);
        });

        table.appendChild(tbody);
        return table;
      }

      // Clear popup content and set title
      function setPopup(title, content) {
        pageTitle.textContent = title;
        popupContent.innerHTML = '';
        popupContent.appendChild(content);
        popupContent.focus();
      }

      // Show alert modal for confirmation
      function confirmDialog(message) {
        return new Promise((resolve) => {
          const overlay = document.createElement('div');
          overlay.className =
            'fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50';

          const dialog = document.createElement('div');
          dialog.className =
            'bg-white rounded-lg shadow-lg max-w-sm w-full p-6 space-y-4 text-center';

          const msg = document.createElement('p');
          msg.className = 'text-gray-800 text-lg';
          msg.textContent = message;

          const btns = document.createElement('div');
          btns.className = 'flex justify-center space-x-4';

          const btnYes = document.createElement('button');
          btnYes.className =
            'bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500';
          btnYes.textContent = 'Ya';

          const btnNo = document.createElement('button');
          btnNo.className =
            'bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-400';
          btnNo.textContent = 'Tidak';

          btnYes.addEventListener('click', () => {
            document.body.removeChild(overlay);
            resolve(true);
          });
          btnNo.addEventListener('click', () => {
            document.body.removeChild(overlay);
            resolve(false);
          });

          btns.appendChild(btnYes);
          btns.appendChild(btnNo);
          dialog.appendChild(msg);
          dialog.appendChild(btns);
          overlay.appendChild(dialog);
          document.body.appendChild(overlay);
        });
      }

      // Form modal for editing/adding
      function formModal(title, fields, onSubmit, initialData = {}) {
        return new Promise((resolve) => {
          const overlay = document.createElement('div');
          overlay.className =
            'fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 overflow-auto p-4';

          const dialog = document.createElement('form');
          dialog.className =
            'bg-white rounded-lg shadow-lg max-w-lg w-full p-6 space-y-6';
          dialog.noValidate = true;

          const h3 = document.createElement('h3');
          h3.className = 'text-xl font-semibold text-gray-800';
          h3.textContent = title;

          dialog.appendChild(h3);

          const inputs = {};

          fields.forEach(({ label, name, type = 'text', required = false, options, placeholder }) => {
            const fieldWrapper = document.createElement('div');
            fieldWrapper.className = 'flex flex-col';

            const labelEl = document.createElement('label');
            labelEl.htmlFor = name;
            labelEl.className = 'mb-1 font-medium text-gray-700';
            labelEl.textContent = label + (required ? ' *' : '');

            let inputEl;
            if (type === 'select') {
              inputEl = document.createElement('select');
              inputEl.className =
                'rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-500';
              options.forEach((opt) => {
                const optionEl = document.createElement('option');
                optionEl.value = opt.value;
                optionEl.textContent = opt.label;
                inputEl.appendChild(optionEl);
              });
            } else if (type === 'textarea') {
              inputEl = document.createElement('textarea');
              inputEl.rows = 3;
              inputEl.className =
                'rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-500 resize-y';
              if (placeholder) inputEl.placeholder = placeholder;
            } else if (type === 'date') {
              inputEl = document.createElement('input');
              inputEl.type = 'date';
              inputEl.className =
                'rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-500';
            } else if (type === 'number') {
              inputEl = document.createElement('input');
              inputEl.type = 'number';
              inputEl.min = '0';
              inputEl.className =
                'rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-500';
              if (placeholder) inputEl.placeholder = placeholder;
            } else {
              inputEl = document.createElement('input');
              inputEl.type = type;
              inputEl.className =
                'rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-500';
              if (placeholder) inputEl.placeholder = placeholder;
            }

            inputEl.id = name;
            inputEl.name = name;
            if (required) inputEl.required = true;
            if (initialData[name] !== undefined) {
              if (type === 'date' && initialData[name]) {
                inputEl.value = initialData[name];
              } else if (type === 'select') {
                inputEl.value = initialData[name];
              } else {
                inputEl.value = initialData[name];
              }
            }

            fieldWrapper.appendChild(labelEl);
            fieldWrapper.appendChild(inputEl);
            dialog.appendChild(fieldWrapper);
            inputs[name] = inputEl;
          });

          const btns = document.createElement('div');
          btns.className = 'flex justify-end space-x-3';

          const btnCancel = document.createElement('button');
          btnCancel.type = 'button';
          btnCancel.className =
            'bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-400';
          btnCancel.textContent = 'Batal';
          btnCancel.addEventListener('click', () => {
            document.body.removeChild(overlay);
            resolve(null);
          });

          const btnSubmit = document.createElement('button');
          btnSubmit.type = 'submit';
          btnSubmit.className =
            'bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500';
          btnSubmit.textContent = 'Simpan';

          btns.appendChild(btnCancel);
          btns.appendChild(btnSubmit);
          dialog.appendChild(btns);

          dialog.addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = {};
            let valid = true;
            Object.entries(inputs).forEach(([key, input]) => {
              if (input.required && !input.value.trim()) {
                input.focus();
                valid = false;
                return;
              }
              formData[key] = input.type === 'number' ? Number(input.value) : input.value.trim();
            });
            if (!valid) return;
            onSubmit(formData);
            document.body.removeChild(overlay);
            resolve(formData);
          });

          overlay.appendChild(dialog);
          document.body.appendChild(overlay);
          inputs[Object.keys(inputs)[0]].focus();
        });
      }

      // Render Master User
      function renderMasterUser() {
        const headers = ['ID', 'Username', 'Nama Lengkap', 'Role'];
        const rows = data.users.map((u) => [u.id, u.username, u.fullName, u.role]);

        function onEdit(row, index) {
          const user = data.users[index];
          formModal(
            'Edit Master User',
            [
              { label: 'Username', name: 'username', required: true },
              { label: 'Nama Lengkap', name: 'fullName', required: true },
              {
                label: 'Role',
                name: 'role',
                type: 'select',
                options: [
                  { label: 'Admin', value: 'Admin' },
                  { label: 'User', value: 'User' },
                ],
                required: true,
              },
            ],
            (formData) => {
              user.username = formData.username;
              user.fullName = formData.fullName;
              user.role = formData.role;
              renderMasterUser();
            },
            user
          );
        }

        async function onDelete(row, index) {
          const confirmed = await confirmDialog(
            `Hapus user "${data.users[index].username}"?`
          );
          if (confirmed) {
            data.users.splice(index, 1);
            renderMasterUser();
          }
        }

        const table = createTable(headers, rows, onEdit, onDelete);

        // Add button to add new user
        const container = document.createElement('div');
        const btnAdd = document.createElement('button');
        btnAdd.type = 'button';
        btnAdd.className =
          'mb-4 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500';
        btnAdd.innerHTML = '<i class="fas fa-plus mr-2"></i>Tambah User';
        btnAdd.addEventListener('click', () => {
          formModal(
            'Tambah Master User',
            [
              { label: 'Username', name: 'username', required: true },
              { label: 'Nama Lengkap', name: 'fullName', required: true },
              {
                label: 'Role',
                name: 'role',
                type: 'select',
                options: [
                  { label: 'Admin', value: 'Admin' },
                  { label: 'User', value: 'User' },
                ],
                required: true,
              },
            ],
            (formData) => {
              const newId =
                data.users.length > 0
                  ? Math.max(...data.users.map((u) => u.id)) + 1
                  : 1;
              data.users.push({
                id: newId,
                username: formData.username,
                fullName: formData.fullName,
                role: formData.role,
              });
              renderMasterUser();
            }
          );
        });

        container.appendChild(btnAdd);
        container.appendChild(table);
        setPopup('Master User', container);
      }

      // Render Master Harga Barang & Jumlah
      function renderMasterHarga() {
        const headers = ['ID', 'Nama Barang', 'Harga (Rp)', 'Jumlah Stok'];
        const rows = data.hargaBarang.map((h) => [
          h.id,
          h.namaBarang,
          formatRupiah(h.harga),
          h.jumlah,
        ]);

        function onEdit(row, index) {
          const item = data.hargaBarang[index];
          formModal(
            'Edit Master Harga Barang & Jumlah',
            [
              { label: 'Nama Barang', name: 'namaBarang', required: true },
              { label: 'Harga (Rp)', name: 'harga', type: 'number', required: true },
              { label: 'Jumlah Stok', name: 'jumlah', type: 'number', required: true },
            ],
            (formData) => {
              item.namaBarang = formData.namaBarang;
              item.harga = formData.harga;
              item.jumlah = formData.jumlah;
              renderMasterHarga();
            },
            item
          );
        }

        async function onDelete(row, index) {
          const confirmed = await confirmDialog(
            `Hapus barang "${data.hargaBarang[index].namaBarang}"?`
          );
          if (confirmed) {
            data.hargaBarang.splice(index, 1);
            renderMasterHarga();
          }
        }

        const table = createTable(headers, rows, onEdit, onDelete);

        const container = document.createElement('div');
        const btnAdd = document.createElement('button');
        btnAdd.type = 'button';
        btnAdd.className =
          'mb-4 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500';
        btnAdd.innerHTML = '<i class="fas fa-plus mr-2"></i>Tambah Barang';
        btnAdd.addEventListener('click', () => {
          formModal(
            'Tambah Master Harga Barang & Jumlah',
            [
              { label: 'Nama Barang', name: 'namaBarang', required: true },
              { label: 'Harga (Rp)', name: 'harga', type: 'number', required: true },
              { label: 'Jumlah Stok', name: 'jumlah', type: 'number', required: true },
            ],
            (formData) => {
              const newId =
                data.hargaBarang.length > 0
                  ? Math.max(...data.hargaBarang.map((h) => h.id)) + 1
                  : 1;
              data.hargaBarang.push({
                id: newId,
                namaBarang: formData.namaBarang,
                harga: formData.harga,
                jumlah: formData.jumlah,
              });
              renderMasterHarga();
            }
          );
        });

        container.appendChild(btnAdd);
        container.appendChild(table);
        setPopup('Master Harga Barang & Jumlah', container);
      }

      // Render Master Supplier
      function renderMasterSupplier() {
        const headers = ['ID', 'Nama Supplier', 'Alamat', 'Telepon'];
        const rows = data.suppliers.map((s) => [s.id, s.nama, s.alamat, s.telepon]);

        function onEdit(row, index) {
          const supplier = data.suppliers[index];
          formModal(
            'Edit Master Supplier',
            [
              { label: 'Nama Supplier', name: 'nama', required: true },
              { label: 'Alamat', name: 'alamat', type: 'textarea', required: true },
              { label: 'Telepon', name: 'telepon', required: true },
            ],
            (formData) => {
              supplier.nama = formData.nama;
              supplier.alamat = formData.alamat;
              supplier.telepon = formData.telepon;
              renderMasterSupplier();
            },
            supplier
          );
        }

        async function onDelete(row, index) {
          const confirmed = await confirmDialog(
            `Hapus supplier "${data.suppliers[index].nama}"?`
          );
          if (confirmed) {
            data.suppliers.splice(index, 1);
            renderMasterSupplier();
          }
        }

        const table = createTable(headers, rows, onEdit, onDelete);

        const container = document.createElement('div');
        const btnAdd = document.createElement('button');
        btnAdd.type = 'button';
        btnAdd.className =
          'mb-4 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500';
        btnAdd.innerHTML = '<i class="fas fa-plus mr-2"></i>Tambah Supplier';
        btnAdd.addEventListener('click', () => {
          formModal(
            'Tambah Master Supplier',
            [
              { label: 'Nama Supplier', name: 'nama', required: true },
              { label: 'Alamat', name: 'alamat', type: 'textarea', required: true },
              { label: 'Telepon', name: 'telepon', required: true },
            ],
            (formData) => {
              const newId =
                data.suppliers.length > 0
                  ? Math.max(...data.suppliers.map((s) => s.id)) + 1
                  : 1;
              data.suppliers.push({
                id: newId,
                nama: formData.nama,
                alamat: formData.alamat,
                telepon: formData.telepon,
              });
              renderMasterSupplier();
            }
          );
        });

        container.appendChild(btnAdd);
        container.appendChild(table);
        setPopup('Master Supplier', container);
      }

      // Render Master Customer
      function renderMasterCustomer() {
        const headers = ['ID', 'Nama Customer', 'Alamat', 'Telepon'];
        const rows = data.customers.map((c) => [c.id, c.nama, c.alamat, c.telepon]);

        function onEdit(row, index) {
          const customer = data.customers[index];
          formModal(
            'Edit Master Customer',
            [
              { label: 'Nama Customer', name: 'nama', required: true },
              { label: 'Alamat', name: 'alamat', type: 'textarea', required: true },
              { label: 'Telepon', name: 'telepon', required: true },
            ],
            (formData) => {
              customer.nama = formData.nama;
              customer.alamat = formData.alamat;
              customer.telepon = formData.telepon;
              renderMasterCustomer();
            },
            customer
          );
        }

        async function onDelete(row, index) {
          const confirmed = await confirmDialog(
            `Hapus customer "${data.customers[index].nama}"?`
          );
          if (confirmed) {
            data.customers.splice(index, 1);
            renderMasterCustomer();
          }
        }

        const table = createTable(headers, rows, onEdit, onDelete);

        const container = document.createElement('div');
        const btnAdd = document.createElement('button');
        btnAdd.type = 'button';
        btnAdd.className =
          'mb-4 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500';
        btnAdd.innerHTML = '<i class="fas fa-plus mr-2"></i>Tambah Customer';
        btnAdd.addEventListener('click', () => {
          formModal(
            'Tambah Master Customer',
            [
              { label: 'Nama Customer', name: 'nama', required: true },
              { label: 'Alamat', name: 'alamat', type: 'textarea', required: true },
              { label: 'Telepon', name: 'telepon', required: true },
            ],
            (formData) => {
              const newId =
                data.customers.length > 0
                  ? Math.max(...data.customers.map((c) => c.id)) + 1
                  : 1;
              data.customers.push({
                id: newId,
                nama: formData.nama,
                alamat: formData.alamat,
                telepon: formData.telepon,
              });
              renderMasterCustomer();
            }
          );
        });

        container.appendChild(btnAdd);
        container.appendChild(table);
        setPopup('Master Customer', container);
      }

      // Render Data Entri Transaksi Penjualan
      function renderDataEntriPenjualan() {
        const headers = [
          'ID',
          'Tanggal',
          'Customer',
          'Barang',
          'Jumlah',
          'Harga (Rp)',
          'Keterangan',
          'Total (Rp)',
        ];
        const rows = data.transaksiPenjualan.map((t) => [
          t.id,
          t.tanggal,
          t.customer,
          t.barang,
          t.jumlah,
          formatRupiah(t.harga),
          t.keterangan,
          formatRupiah(t.jumlah * t.harga),
        ]);

        function onEdit(row, index) {
          const transaksi = data.transaksiPenjualan[index];
          formModal(
            'Edit Data Entri Transaksi Penjualan',
            [
              {
                label: 'Tanggal',
                name: 'tanggal',
                type: 'date',
                required: true,
              },
              {
                label: 'Customer',
                name: 'customer',
                type: 'select',
                options: data.customers.map((c) => ({
                  label: c.nama,
                  value: c.nama,
                })),
                required: true,
              },
              {
                label: 'Barang',
                name: 'barang',
                type: 'select',
                options: data.hargaBarang.map((h) => ({
                  label: h.namaBarang,
                  value: h.namaBarang,
                })),
                required: true,
              },
              {
                label: 'Jumlah',
                name: 'jumlah',
                type: 'number',
                required: true,
              },
              {
                label: 'Harga (Rp)',
                name: 'harga',
                type: 'number',
                required: true,
              },
              {
                label: 'Keterangan',
                name: 'keterangan',
                type: 'textarea',
                required: false,
                placeholder: 'Keterangan tambahan',
              },
            ],
            (formData) => {
              transaksi.tanggal = formData.tanggal;
              transaksi.customer = formData.customer;
              transaksi.barang = formData.barang;
              transaksi.jumlah = formData.jumlah;
              transaksi.harga = formData.harga;
              transaksi.keterangan = formData.keterangan;
              renderDataEntriPenjualan();
            },
            transaksi
          );
        }

        async function onDelete(row, index) {
          const confirmed = await confirmDialog(
            `Hapus transaksi penjualan ID ${data.transaksiPenjualan[index].id}?`
          );
          if (confirmed) {
            data.transaksiPenjualan.splice(index, 1);
            renderDataEntriPenjualan();
          }
        }

        const table = createTable(headers, rows, onEdit, onDelete);

        const container = document.createElement('div');
        const btnAdd = document.createElement('button');
        btnAdd.type = 'button';
        btnAdd.className =
          'mb-4 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500';
        btnAdd.innerHTML = '<i class="fas fa-plus mr-2"></i>Tambah Transaksi Penjualan';
        btnAdd.addEventListener('click', () => {
          formModal(
            'Tambah Data Entri Transaksi Penjualan',
            [
              {
                label: 'Tanggal',
                name: 'tanggal',
                type: 'date',
                required: true,
              },
              {
                label: 'Customer',
                name: 'customer',
                type: 'select',
                options: data.customers.map((c) => ({
                  label: c.nama,
                  value: c.nama,
                })),
                required: true,
              },
              {
                label: 'Barang',
                name: 'barang',
                type: 'select',
                options: data.hargaBarang.map((h) => ({
                  label: h.namaBarang,
                  value: h.namaBarang,
                })),
                required: true,
              },
              {
                label: 'Jumlah',
                name: 'jumlah',
                type: 'number',
                required: true,
              },
              {
                label: 'Harga (Rp)',
                name: 'harga',
                type: 'number',
                required: true,
              },
              {
                label: 'Keterangan',
                name: 'keterangan',
                type: 'textarea',
                required: false,
                placeholder: 'Keterangan tambahan',
              },
            ],
            (formData) => {
              const newId =
                data.transaksiPenjualan.length > 0
                  ? Math.max(...data.transaksiPenjualan.map((t) => t.id)) + 1
                  : 1;
              data.transaksiPenjualan.push({
                id: newId,
                tanggal: formData.tanggal,
                customer: formData.customer,
                barang: formData.barang,
                jumlah: formData.jumlah,
                harga: formData.harga,
                keterangan: formData.keterangan,
              });
              renderDataEntriPenjualan();
            }
          );
        });

        container.appendChild(btnAdd);
        container.appendChild(table);
        setPopup('Data Entri Transaksi Penjualan', container);
      }

      // Render Data Entri Pembelian Barang dari Supplier
      function renderDataEntriPembelian() {
        const headers = [
          'ID',
          'Tanggal',
          'Supplier',
          'Barang',
          'Jumlah',
          'Harga (Rp)',
          'Keterangan',
          'Total (Rp)',
        ];
        const rows = data.transaksiPembelian.map((t) => [
          t.id,
          t.tanggal,
          t.supplier,
          t.barang,
          t.jumlah,
          formatRupiah(t.harga),
          t.keterangan,
          formatRupiah(t.jumlah * t.harga),
        ]);

        function onEdit(row, index) {
          const transaksi = data.transaksiPembelian[index];
          formModal(
            'Edit Data Entri Pembelian Barang dari Supplier',
            [
              {
                label: 'Tanggal',
                name: 'tanggal',
                type: 'date',
                required: true,
              },
              {
                label: 'Supplier',
                name: 'supplier',
                type: 'select',
                options: data.suppliers.map((s) => ({
                  label: s.nama,
                  value: s.nama,
                })),
                required: true,
              },
              {
                label: 'Barang',
                name: 'barang',
                type: 'select',
                options: data.hargaBarang.map((h) => ({
                  label: h.namaBarang,
                  value: h.namaBarang,
                })),
                required: true,
              },
              {
                label: 'Jumlah',
                name: 'jumlah',
                type: 'number',
                required: true,
              },
              {
                label: 'Harga (Rp)',
                name: 'harga',
                type: 'number',
                required: true,
              },
              {
                label: 'Keterangan',
                name: 'keterangan',
                type: 'textarea',
                required: false,
                placeholder: 'Keterangan tambahan',
              },
            ],
            (formData) => {
              transaksi.tanggal = formData.tanggal;
              transaksi.supplier = formData.supplier;
              transaksi.barang = formData.barang;
              transaksi.jumlah = formData.jumlah;
              transaksi.harga = formData.harga;
              transaksi.keterangan = formData.keterangan;
              renderDataEntriPembelian();
            },
            transaksi
          );
        }

        async function onDelete(row, index) {
          const confirmed = await confirmDialog(
            `Hapus transaksi pembelian ID ${data.transaksiPembelian[index].id}?`
          );
          if (confirmed) {
            data.transaksiPembelian.splice(index, 1);
            renderDataEntriPembelian();
          }
        }

        const table = createTable(headers, rows, onEdit, onDelete);

        const container = document.createElement('div');
        const btnAdd = document.createElement('button');
        btnAdd.type = 'button';
        btnAdd.className =
          'mb-4 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500';
        btnAdd.innerHTML = '<i class="fas fa-plus mr-2"></i>Tambah Transaksi Pembelian';
        btnAdd.addEventListener('click', () => {
          formModal(
            'Tambah Data Entri Pembelian Barang dari Supplier',
            [
              {
                label: 'Tanggal',
                name: 'tanggal',
                type: 'date',
                required: true,
              },
              {
                label: 'Supplier',
                name: 'supplier',
                type: 'select',
                options: data.suppliers.map((s) => ({
                  label: s.nama,
                  value: s.nama,
                })),
                required: true,
              },
              {
                label: 'Barang',
                name: 'barang',
                type: 'select',
                options: data.hargaBarang.map((h) => ({
                  label: h.namaBarang,
                  value: h.namaBarang,
                })),
                required: true,
              },
              {
                label: 'Jumlah',
                name: 'jumlah',
                type: 'number',
                required: true,
              },
              {
                label: 'Harga (Rp)',
                name: 'harga',
                type: 'number',
                required: true,
              },
              {
                label: 'Keterangan',
                name: 'keterangan',
                type: 'textarea',
                required: false,
                placeholder: 'Keterangan tambahan',
              },
            ],
            (formData) => {
              const newId =
                data.transaksiPembelian.length > 0
                  ? Math.max(...data.transaksiPembelian.map((t) => t.id)) + 1
                  : 1;
              data.transaksiPembelian.push({
                id: newId,
                tanggal: formData.tanggal,
                supplier: formData.supplier,
                barang: formData.barang,
                jumlah: formData.jumlah,
                harga: formData.harga,
                keterangan: formData.keterangan,
              });
              renderDataEntriPembelian();
            }
          );
        });

        container.appendChild(btnAdd);
        container.appendChild(table);
        setPopup('Data Entri Pembelian Barang dari Supplier', container);
      }

      // Render Laporan Transaksi Penjualan Per Periode
      function renderLaporanPenjualanPerPeriode() {
        // Filter by date range
        const container = document.createElement('div');
        container.className = 'space-y-4';

        const formFilter = document.createElement('form');
        formFilter.className = 'flex flex-wrap items-end gap-4';

        const labelStart = document.createElement('label');
        labelStart.className = 'flex flex-col text-gray-700 font-medium';
        labelStart.textContent = 'Tanggal Mulai';
        const inputStart = document.createElement('input');
        inputStart.type = 'date';
        inputStart.className =
          'mt-1 rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-500';
        labelStart.appendChild(inputStart);

        const labelEnd = document.createElement('label');
        labelEnd.className = 'flex flex-col text-gray-700 font-medium';
        labelEnd.textContent = 'Tanggal Akhir';
        const inputEnd = document.createElement('input');
        inputEnd.type = 'date';
        inputEnd.className =
          'mt-1 rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-500';
        labelEnd.appendChild(inputEnd);

        const btnFilter = document.createElement('button');
        btnFilter.type = 'submit';
        btnFilter.className =
          'bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500';
        btnFilter.textContent = 'Tampilkan';

        formFilter.appendChild(labelStart);
        formFilter.appendChild(labelEnd);
        formFilter.appendChild(btnFilter);

        const tableContainer = document.createElement('div');
        tableContainer.className = 'overflow-auto max-h-[400px]';

        formFilter.addEventListener('submit', (e) => {
          e.preventDefault();
          const start = inputStart.value;
          const end = inputEnd.value;
          if (!start || !end) {
            alert('Harap isi tanggal mulai dan tanggal akhir.');
            return;
          }
          if (start > end) {
            alert('Tanggal mulai harus sebelum tanggal akhir.');
            return;
          }
          const filtered = data.transaksiPenjualan.filter(
            (t) => t.tanggal >= start && t.tanggal <= end
          );
          renderTable(filtered);
        });

        function renderTable(filteredData) {
          if (filteredData.length === 0) {
            tableContainer.innerHTML =
              '<p class="text-center text-gray-500 mt-10 select-none">Tidak ada data transaksi penjualan pada periode ini.</p>';
            return;
          }
          const headers = [
            'Customer',
            'Barang',
            'Jumlah',
            'Harga (Rp)',
            'Keterangan',
            'Total (Rp)',
          ];
          const rows = filteredData.map((t) => [
            t.customer,
            t.barang,
            t.jumlah,
            formatRupiah(t.harga),
            t.keterangan,
            formatRupiah(t.jumlah * t.harga),
          ]);
          const grandTotal = filteredData.reduce(
            (acc, cur) => acc + cur.jumlah * cur.harga,
            0
          );

          const table = document.createElement('table');
          table.className =
            'min-w-full divide-y divide-gray-200 border border-gray-300 rounded-md';

          const thead = document.createElement('thead');
          thead.className = 'bg-blue-50';
          const trHead = document.createElement('tr');
          headers.forEach((h) => {
            const th = document.createElement('th');
            th.scope = 'col';
            th.className =
              'px-4 py-2 text-left text-xs font-medium text-blue-700 uppercase tracking-wider select-none';
            th.textContent = h;
            trHead.appendChild(th);
          });
          const thTotal = document.createElement('th');
          thTotal.className =
            'px-4 py-2 text-right text-xs font-medium text-blue-700 uppercase tracking-wider select-none';
          thTotal.textContent = 'Total';
          trHead.appendChild(thTotal);
          thead.appendChild(trHead);
          table.appendChild(thead);

          const tbody = document.createElement('tbody');
          tbody.className = 'bg-white divide-y divide-gray-200';

          rows.forEach((row, i) => {
            const tr = document.createElement('tr');
            tr.className = i % 2 === 0 ? '' : 'bg-gray-50';
            row.forEach((cell) => {
              const td = document.createElement('td');
              td.className = 'px-4 py-2 text-sm text-gray-700 whitespace-nowrap';
              td.textContent = cell;
              tr.appendChild(td);
            });
            const tdTotal = document.createElement('td');
            tdTotal.className = 'px-4 py-2 text-right font-semibold text-gray-800';
            tdTotal.textContent = formatRupiah(row[2] * parseInt(row[3].replace(/\D/g, '')));
            tr.appendChild(tdTotal);
            tbody.appendChild(tr);
          });

          // Grand total row
          const trGrand = document.createElement('tr');
          trGrand.className = 'bg-blue-100 font-semibold text-gray-800';
          const tdLabel = document.createElement('td');
          tdLabel.colSpan = headers.length;
          tdLabel.className = 'px-4 py-2 text-right';
          tdLabel.textContent = 'Grand Total';
          trGrand.appendChild(tdLabel);
          const tdGrandTotal = document.createElement('td');
          tdGrandTotal.className = 'px-4 py-2 text-right';
          tdGrandTotal.textContent = formatRupiah(grandTotal);
          trGrand.appendChild(tdGrandTotal);
          tbody.appendChild(trGrand);

          table.appendChild(tbody);
          tableContainer.innerHTML = '';
          tableContainer.appendChild(table);
        }

        container.appendChild(formFilter);
        container.appendChild(tableContainer);
        setPopup('Laporan Transaksi Penjualan Per Periode', container);
      }

      // Render Laporan Transaksi Bulanan Pembelian dari Supplier
      function renderLaporanPembelianBulanan() {
        const container = document.createElement('div');
        container.className = 'space-y-4';

        const formFilter = document.createElement('form');
        formFilter.className = 'flex flex-wrap items-end gap-4';

        const labelMonth = document.createElement('label');
        labelMonth.className = 'flex flex-col text-gray-700 font-medium';
        labelMonth.textContent = 'Bulan dan Tahun';
        const inputMonth = document.createElement('input');
        inputMonth.type = 'month';
        inputMonth.className =
          'mt-1 rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-500';
        labelMonth.appendChild(inputMonth);

        const btnFilter = document.createElement('button');
        btnFilter.type = 'submit';
        btnFilter.className =
          'bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500';
        btnFilter.textContent = 'Tampilkan';

        formFilter.appendChild(labelMonth);
        formFilter.appendChild(btnFilter);

        const tableContainer = document.createElement('div');
        tableContainer.className = 'overflow-auto max-h-[400px]';

        formFilter.addEventListener('submit', (e) => {
          e.preventDefault();
          const month = inputMonth.value;
          if (!month) {
            alert('Harap pilih bulan dan tahun.');
            return;
          }
          const [year, mon] = month.split('-');
          const filtered = data.transaksiPembelian.filter((t) => {
            const [tYear, tMonth] = t.tanggal.split('-');
            return tYear === year && tMonth === mon;
          });
          renderTable(filtered);
        });

        function renderTable(filteredData) {
          if (filteredData.length === 0) {
            tableContainer.innerHTML =
              '<p class="text-center text-gray-500 mt-10 select-none">Tidak ada data pembelian pada bulan ini.</p>';
            return;
          }
          const headers = [
            'Tanggal',
            'Supplier',
            'Barang',
            'Jumlah',
            'Harga (Rp)',
            'Keterangan',
            'Total (Rp)',
          ];
          const rows = filteredData.map((t) => [
            t.tanggal,
            t.supplier,
            t.barang,
            t.jumlah,
            formatRupiah(t.harga),
            t.keterangan,
            formatRupiah(t.jumlah * t.harga),
          ]);
          const grandTotal = filteredData.reduce(
            (acc, cur) => acc + cur.jumlah * cur.harga,
            0
          );

          const table = document.createElement('table');
          table.className =
            'min-w-full divide-y divide-gray-200 border border-gray-300 rounded-md';

          const thead = document.createElement('thead');
          thead.className = 'bg-blue-50';
          const trHead = document.createElement('tr');
          headers.forEach((h) => {
            const th = document.createElement('th');
            th.scope = 'col';
            th.className =
              'px-4 py-2 text-left text-xs font-medium text-blue-700 uppercase tracking-wider select-none';
            th.textContent = h;
            trHead.appendChild(th);
          });
          const thTotal = document.createElement('th');
          thTotal.className =
            'px-4 py-2 text-right text-xs font-medium text-blue-700 uppercase tracking-wider select-none';
          thTotal.textContent = 'Total';
          trHead.appendChild(thTotal);
          thead.appendChild(trHead);
          table.appendChild(thead);

          const tbody = document.createElement('tbody');
          tbody.className = 'bg-white divide-y divide-gray-200';

          rows.forEach((row, i) => {
            const tr = document.createElement('tr');
            tr.className = i % 2 === 0 ? '' : 'bg-gray-50';
            row.forEach((cell) => {
              const td = document.createElement('td');
              td.className = 'px-4 py-2 text-sm text-gray-700 whitespace-nowrap';
              td.textContent = cell;
              tr.appendChild(td);
            });
            const tdTotal = document.createElement('td');
            tdTotal.className = 'px-4 py-2 text-right font-semibold text-gray-800';
            tdTotal.textContent = formatRupiah(row[3] * parseInt(row[4].replace(/\D/g, '')));
            tr.appendChild(tdTotal);
            tbody.appendChild(tr);
          });

          // Grand total row
          const trGrand = document.createElement('tr');
          trGrand.className = 'bg-blue-100 font-semibold text-gray-800';
          const tdLabel = document.createElement('td');
          tdLabel.colSpan = headers.length;
          tdLabel.className = 'px-4 py-2 text-right';
          tdLabel.textContent = 'Grand Total';
          trGrand.appendChild(tdLabel);
          const tdGrandTotal = document.createElement('td');
          tdGrandTotal.className = 'px-4 py-2 text-right';
          tdGrandTotal.textContent = formatRupiah(grandTotal);
          trGrand.appendChild(tdGrandTotal);
          tbody.appendChild(trGrand);

          table.appendChild(tbody);
          tableContainer.innerHTML = '';
          tableContainer.appendChild(table);
        }

        container.appendChild(formFilter);
        container.appendChild(tableContainer);
        setPopup('Laporan Transaksi Bulanan Pembelian dari Supplier', container);
      }

      // Render Laporan Bulanan Transaksi Penjualan
      function renderLaporanPenjualanBulanan() {
        const container = document.createElement('div');
        container.className = 'space-y-4';

        const formFilter = document.createElement('form');
        formFilter.className = 'flex flex-wrap items-end gap-4';

        const labelMonth = document.createElement('label');
        labelMonth.className = 'flex flex-col text-gray-700 font-medium';
        labelMonth.textContent = 'Bulan dan Tahun';
        const inputMonth = document.createElement('input');
        inputMonth.type = 'month';
        inputMonth.className =
          'mt-1 rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-500';
        labelMonth.appendChild(inputMonth);

        const btnFilter = document.createElement('button');
        btnFilter.type = 'submit';
        btnFilter.className =
          'bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500';
        btnFilter.textContent = 'Tampilkan';

        formFilter.appendChild(labelMonth);
        formFilter.appendChild(btnFilter);

        const tableContainer = document.createElement('div');
        tableContainer.className = 'overflow-auto max-h-[400px]';

        formFilter.addEventListener('submit', (e) => {
          e.preventDefault();
          const month = inputMonth.value;
          if (!month) {
            alert('Harap pilih bulan dan tahun.');
            return;
          }
          const [year, mon] = month.split('-');
          const filtered = data.transaksiPenjualan.filter((t) => {
            const [tYear, tMonth] = t.tanggal.split('-');
            return tYear === year && tMonth === mon;
          });
          renderTable(filtered);
        });

        function renderTable(filteredData) {
          if (filteredData.length === 0) {
            tableContainer.innerHTML =
              '<p class="text-center text-gray-500 mt-10 select-none">Tidak ada data penjualan pada bulan ini.</p>';
            return;
          }
          const headers = [
            'Tanggal',
            'Customer',
            'Barang',
            'Jumlah',
            'Harga (Rp)',
            'Keterangan',
            'Total (Rp)',
          ];
          const rows = filteredData.map((t) => [
            t.tanggal,
            t.customer,
            t.barang,
            t.jumlah,
            formatRupiah(t.harga),
            t.keterangan,
            formatRupiah(t.jumlah * t.harga),
          ]);
          const grandTotal = filteredData.reduce(
            (acc, cur) => acc + cur.jumlah * cur.harga,
            0
          );

          const table = document.createElement('table');
          table.className =
            'min-w-full divide-y divide-gray-200 border border-gray-300 rounded-md';

          const thead = document.createElement('thead');
          thead.className = 'bg-blue-50';
          const trHead = document.createElement('tr');
          headers.forEach((h) => {
            const th = document.createElement('th');
            th.scope = 'col';
            th.className =
              'px-4 py-2 text-left text-xs font-medium text-blue-700 uppercase tracking-wider select-none';
            th.textContent = h;
            trHead.appendChild(th);
          });
          const thTotal = document.createElement('th');
          thTotal.className =
            'px-4 py-2 text-right text-xs font-medium text-blue-700 uppercase tracking-wider select-none';
          thTotal.textContent = 'Total';
          trHead.appendChild(thTotal);
          thead.appendChild(trHead);
          table.appendChild(thead);

          const tbody = document.createElement('tbody');
          tbody.className = 'bg-white divide-y divide-gray-200';

          rows.forEach((row, i) => {
            const tr = document.createElement('tr');
            tr.className = i % 2 === 0 ? '' : 'bg-gray-50';
            row.forEach((cell) => {
              const td = document.createElement('td');
              td.className = 'px-4 py-2 text-sm text-gray-700 whitespace-nowrap';
              td.textContent = cell;
              tr.appendChild(td);
            });
            const tdTotal = document.createElement('td');
            tdTotal.className = 'px-4 py-2 text-right font-semibold text-gray-800';
            tdTotal.textContent = formatRupiah(row[3] * parseInt(row[4].replace(/\D/g, '')));
            tr.appendChild(tdTotal);
            tbody.appendChild(tr);
          });

          // Grand total row
          const trGrand = document.createElement('tr');
          trGrand.className = 'bg-blue-100 font-semibold text-gray-800';
          const tdLabel = document.createElement('td');
          tdLabel.colSpan = headers.length;
          tdLabel.className = 'px-4 py-2 text-right';
          tdLabel.textContent = 'Grand Total';
          trGrand.appendChild(tdLabel);
          const tdGrandTotal = document.createElement('td');
          tdGrandTotal.className = 'px-4 py-2 text-right';
          tdGrandTotal.textContent = formatRupiah(grandTotal);
          trGrand.appendChild(tdGrandTotal);
          tbody.appendChild(trGrand);

          table.appendChild(tbody);
          tableContainer.innerHTML = '';
          tableContainer.appendChild(table);
        }

        container.appendChild(formFilter);
        container.appendChild(tableContainer);
        setPopup('Laporan Bulanan Transaksi Penjualan', container);
      }

      // Render Laporan Laba Rugi Per Periode
      function renderLaporanLabaRugiPerPeriode() {
        const container = document.createElement('div');
        container.className = 'space-y-4';

        const formFilter = document.createElement('form');
        formFilter.className = 'flex flex-wrap items-end gap-4';

        const labelStart = document.createElement('label');
        labelStart.className = 'flex flex-col text-gray-700 font-medium';
        labelStart.textContent = 'Tanggal Mulai';
        const inputStart = document.createElement('input');
        inputStart.type = 'date';
        inputStart.className =
          'mt-1 rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-500';
        labelStart.appendChild(inputStart);

        const labelEnd = document.createElement('label');
        labelEnd.className = 'flex flex-col text-gray-700 font-medium';
        labelEnd.textContent = 'Tanggal Akhir';
        const inputEnd = document.createElement('input');
        inputEnd.type = 'date';
        inputEnd.className =
          'mt-1 rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-500';
        labelEnd.appendChild(inputEnd);

        const btnFilter = document.createElement('button');
        btnFilter.type = 'submit';
        btnFilter.className =
          'bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500';
        btnFilter.textContent = 'Tampilkan';

        formFilter.appendChild(labelStart);
        formFilter.appendChild(labelEnd);
        formFilter.appendChild(btnFilter);

        const tableContainer = document.createElement('div');
        tableContainer.className = 'overflow-auto max-h-[400px]';

        formFilter.addEventListener('submit', (e) => {
          e.preventDefault();
          const start = inputStart.value;
          const end = inputEnd.value;
          if (!start || !end) {
            alert('Harap isi tanggal mulai dan tanggal akhir.');
            return;
          }
          if (start > end) {
            alert('Tanggal mulai harus sebelum tanggal akhir.');
            return;
          }
          // Filter penjualan & pembelian
          const penjualan = data.transaksiPenjualan.filter(
            (t) => t.tanggal >= start && t.tanggal <= end
          );
          const pembelian = data.transaksiPembelian.filter(
            (t) => t.tanggal >= start && t.tanggal <= end
          );

          // Hitung total penjualan & pembelian
          const totalPenjualan = penjualan.reduce(
            (acc, cur) => acc + cur.jumlah * cur.harga,
            0
          );
          const totalPembelian = pembelian.reduce(
            (acc, cur) => acc + cur.jumlah * cur.harga,
            0
          );
          const labaRugi = totalPenjualan - totalPembelian;

          const table = document.createElement('table');
          table.className =
            'min-w-full divide-y divide-gray-200 border border-gray-300 rounded-md';

          const thead = document.createElement('thead');
          thead.className = 'bg-blue-50';
          const trHead = document.createElement('tr');
          ['Keterangan', 'Jumlah (Rp)'].forEach((h) => {
            const th = document.createElement('th');
            th.scope = 'col';
            th.className =
              'px-4 py-2 text-left text-xs font-medium text-blue-700 uppercase tracking-wider select-none';
            th.textContent = h;
            trHead.appendChild(th);
          });
          thead.appendChild(trHead);
          table.appendChild(thead);

          const tbody = document.createElement('tbody');
          tbody.className = 'bg-white divide-y divide-gray-200';

          const rows = [
            ['Total Penjualan', formatRupiah(totalPenjualan)],
            ['Total Pembelian', formatRupiah(totalPembelian)],
            ['Laba / Rugi', formatRupiah(labaRugi)],
          ];

          rows.forEach((row, i) => {
            const tr = document.createElement('tr');
            tr.className = i % 2 === 0 ? '' : 'bg-gray-50';
            row.forEach((cell) => {
              const td = document.createElement('td');
              td.className = 'px-4 py-2 text-sm text-gray-700 whitespace-nowrap';
              td.textContent = cell;
              tr.appendChild(td);
            });
            tbody.appendChild(tr);
          });

          table.appendChild(tbody);

          tableContainer.innerHTML = '';
          tableContainer.appendChild(table);
        });

        container.appendChild(formFilter);
        container.appendChild(tableContainer);
        setPopup('Laporan Laba Rugi Per Periode', container);
      }

      // Render Laporan Stok Per Periode
      function renderLaporanStokPerPeriode() {
        const container = document.createElement('div');
        container.className = 'space-y-4';

        const formFilter = document.createElement('form');
        formFilter.className = 'flex flex-wrap items-end gap-4';

        const labelDate = document.createElement('label');
        labelDate.className = 'flex flex-col text-gray-700 font-medium';
        labelDate.textContent = 'Tanggal Periode';
        const inputDate = document.createElement('input');
        inputDate.type = 'date';
        inputDate.className =
          'mt-1 rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-500';
        labelDate.appendChild(inputDate);

        const btnFilter = document.createElement('button');
        btnFilter.type = 'submit';
        btnFilter.className =
          'bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500';
        btnFilter.textContent = 'Tampilkan';

        formFilter.appendChild(labelDate);
        formFilter.appendChild(btnFilter);

        const tableContainer = document.createElement('div');
        tableContainer.className = 'overflow-auto max-h-[400px]';

        formFilter.addEventListener('submit', (e) => {
          e.preventDefault();
          const date = inputDate.value;
          if (!date) {
            alert('Harap isi tanggal periode.');
            return;
          }
          // Hitung stok per barang sampai tanggal tersebut
          // Stok awal = jumlah di master hargaBarang
          // Tambah pembelian sampai tanggal
          // Kurangi penjualan sampai tanggal
          const stokData = data.hargaBarang.map((h) => {
            const pembelianJumlah = data.transaksiPembelian
              .filter((t) => t.barang === h.namaBarang && t.tanggal <= date)
              .reduce((acc, cur) => acc + cur.jumlah, 0);
            const penjualanJumlah = data.transaksiPenjualan
              .filter((t) => t.barang === h.namaBarang && t.tanggal <= date)
              .reduce((acc, cur) => acc + cur.jumlah, 0);
            const stokAkhir = h.jumlah + pembelianJumlah - penjualanJumlah;
            return {
              namaBarang: h.namaBarang,
              stokAwal: h.jumlah,
              pembelian: pembelianJumlah,
              penjualan: penjualanJumlah,
              stokAkhir,
            };
          });

          const headers = [
            'Nama Barang',
            'Stok Awal',
            'Pembelian',
            'Penjualan',
            'Stok Akhir',
          ];
          const rows = stokData.map((s) => [
            s.namaBarang,
            s.stokAwal,
            s.pembelian,
            s.penjualan,
            s.stokAkhir,
          ]);

          const table = document.createElement('table');
          table.className =
            'min-w-full divide-y divide-gray-200 border border-gray-300 rounded-md';

          const thead = document.createElement('thead');
          thead.className = 'bg-blue-50';
          const trHead = document.createElement('tr');
          headers.forEach((h) => {
            const th = document.createElement('th');
            th.scope = 'col';
            th.className =
              'px-4 py-2 text-left text-xs font-medium text-blue-700 uppercase tracking-wider select-none';
            th.textContent = h;
            trHead.appendChild(th);
          });
          thead.appendChild(trHead);
          table.appendChild(thead);

          const tbody = document.createElement('tbody');
          tbody.className = 'bg-white divide-y divide-gray-200';

          rows.forEach((row, i) => {
            const tr = document.createElement('tr');
            tr.className = i % 2 === 0 ? '' : 'bg-gray-50';
            row.forEach((cell) => {
              const td = document.createElement('td');
              td.className = 'px-4 py-2 text-sm text-gray-700 whitespace-nowrap';
              td.textContent = cell;
              tr.appendChild(td);
            });
            tbody.appendChild(tr);
          });

          table.appendChild(tbody);
          tableContainer.innerHTML = '';
          tableContainer.appendChild(table);
        });

        container.appendChild(formFilter);
        container.appendChild(tableContainer);
        setPopup('Laporan Stok Per Periode', container);
      }

      // Menu click handler
      function onMenuClick(e) {
        if (!e.target.dataset.menu) return;
        const menu = e.target.dataset.menu;
        switch (menu) {
          case 'masterUser':
            renderMasterUser();
            break;
          case 'masterHarga':
            renderMasterHarga();
            break;
          case 'masterSupplier':
            renderMasterSupplier();
            break;
          case 'masterCustomer':
            renderMasterCustomer();
            break;
          case 'dataEntriPenjualan':
            renderDataEntriPenjualan();
            break;
          case 'dataEntriPembelian':
            renderDataEntriPembelian();
            break;
          case 'laporanPenjualanPerPeriode':
            renderLaporanPenjualanPerPeriode();
            break;
          case 'laporanPembelianBulanan':
            renderLaporanPembelianBulanan();
            break;
          case 'laporanPenjualanBulanan':
            renderLaporanPenjualanBulanan();
            break;
          case 'laporanLabaRugiPerPeriode':
            renderLaporanLabaRugiPerPeriode();
            break;
          case 'laporanStokPerPeriode':
            renderLaporanStokPerPeriode();
            break;
          default:
            break;
        }
      }

      // Login form submit
      loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const username = usernameInput.value.trim();
        const password = passwordInput.value.trim();
        if (username === 'Admin' && password === 'putra') {
          loginError.classList.add('hidden');
          loginForm.style.display = 'none';
          menuTree.style.display = 'block';
          pageTitle.textContent = 'Selamat Datang di Family Freshwater Refill Depot';
          popupContent.innerHTML =
            '<div class="text-gray-500 text-center mt-20 select-none"><i class="fas fa-info-circle fa-3x mb-4"></i><p>Pilih menu di sebelah kiri untuk mulai mengelola data.</p></div>';
        } else {
          loginError.classList.remove('hidden');
        }
      });

      // Delegate menu clicks
      menuTree.addEventListener('click', onMenuClick);

      // Accessibility: focus trap for popupContent
      popupContent.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          // Reset to welcome screen
          pageTitle.textContent = 'Selamat Datang di Family Freshwater Refill Depot';
          popupContent.innerHTML =
            '<div class="text-gray-500 text-center mt-20 select-none"><i class="fas fa-info-circle fa-3x mb-4"></i><p>Pilih menu di sebelah kiri untuk mulai mengelola data.</p></div>';
        }
      });
    })();
  </script>
 </body>
</html>
